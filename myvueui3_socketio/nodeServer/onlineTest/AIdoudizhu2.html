<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ™ºèƒ½AIæ–—åœ°ä¸»æ¸¸æˆ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #1a5f23, #0d3b1e);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            color: #fff;
            padding: 20px;
        }
        
        .game-container {
            width: 100%;
            max-width: 1000px;
            background: rgba(0, 40, 0, 0.7);
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            padding: 25px;
            position: relative;
            overflow: hidden;
        }
        
        .game-title {
            text-align: center;
            font-size: 36px;
            margin-bottom: 20px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
            color: #ffd700;
            position: relative;
        }
        
        .game-title::after {
            content: "";
            display: block;
            width: 250px;
            height: 3px;
            background: linear-gradient(to right, transparent, #ffd700, transparent);
            margin: 12px auto;
        }
        
        .game-area {
            display: flex;
            flex-direction: column;
            gap: 30px;
        }
        
        .players {
            display: flex;
            justify-content: space-between;
            margin: 20px 0;
        }
        
        .player {
            background: rgba(0, 80, 0, 0.5);
            border-radius: 15px;
            padding: 18px;
            width: 30%;
            text-align: center;
            position: relative;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
        }
        
        .player.active {
            box-shadow: 0 0 25px #ffd700;
            border: 2px solid #ffd700;
            transform: translateY(-5px);
        }
        
        .player-name {
            font-size: 22px;
            margin-bottom: 12px;
            color: #ffd700;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .player-name .landlord-tag {
            background: #ff5722;
            color: white;
            font-size: 14px;
            padding: 2px 8px;
            border-radius: 10px;
        }
        
        .player-cards {
            min-height: 100px;
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 6px;
            padding: 12px;
        }
        
        .card {
            width: 45px;
            height: 65px;
            background: white;
            border-radius: 6px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            padding: 4px;
            box-shadow: 1px 1px 6px rgba(0, 0, 0, 0.3);
            cursor: pointer;
            transition: transform 0.2s;
            position: relative;
        }
        
        .card:hover {
            transform: translateY(-8px);
        }
        
        .card.selected {
            transform: translateY(-18px);
            box-shadow: 0 5px 15px rgba(255, 215, 0, 0.9);
        }
        
        .card-top, .card-bottom {
            font-size: 13px;
            font-weight: bold;
        }
        
        .card-top {
            align-self: flex-start;
        }
        
        .card-bottom {
            align-self: flex-end;
            transform: rotate(180deg);
        }
        
        .card-value {
            font-size: 20px;
            text-align: center;
            font-weight: bold;
        }
        
        .controls {
            display: flex;
            justify-content: center;
            gap: 25px;
            margin: 25px 0;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 14px 30px;
            font-size: 20px;
            background: linear-gradient(to bottom, #ffd700, #ff9800);
            border: none;
            border-radius: 50px;
            color: #8b4513;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.2);
            transition: all 0.3s;
            min-width: 150px;
        }
        
        .btn:hover {
            transform: translateY(-4px);
            box-shadow: 0 9px 20px rgba(0, 0, 0, 0.3);
            background: linear-gradient(to bottom, #ffdf33, #ffa726);
        }
        
        .btn:active {
            transform: translateY(1px);
        }
        
        .btn:disabled {
            background: #666;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .game-info {
            background: rgba(0, 60, 0, 0.7);
            border-radius: 15px;
            padding: 22px;
            margin-top: 20px;
            min-height: 140px;
        }
        
        .info-title {
            color: #ffd700;
            margin-bottom: 12px;
            font-size: 22px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .info-title i {
            font-size: 24px;
        }
        
        .info-content {
            font-size: 20px;
            line-height: 1.6;
            min-height: 30px;
        }
        
        .current-play {
            min-height: 90px;
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 6px;
            padding: 12px;
            background: rgba(0, 40, 0, 0.8);
            border-radius: 12px;
            margin-top: 15px;
        }
        
        .landlord-cards {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            margin: 25px 0;
        }
        
        .status-bar {
            display: flex;
            justify-content: space-between;
            background: rgba(0, 40, 0, 0.8);
            padding: 12px 25px;
            border-radius: 12px;
            margin: 18px 0;
            font-size: 20px;
        }
        
        .card.red { color: #e74c3c; }
        .card.black { color: #2c3e50; }
        
        .ai-level {
            background: rgba(255, 215, 0, 0.2);
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 18px;
            margin-top: 10px;
        }
        
        .card-back {
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #8b0000, #8b4513);
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .card-back::after {
            content: "â™ â™¥â™¦â™£";
            color: rgba(255, 255, 255, 0.3);
            font-size: 24px;
            letter-spacing: 2px;
        }
        
        @media (max-width: 900px) {
            .players {
                flex-direction: column;
                gap: 25px;
            }
            
            .player {
                width: 100%;
            }
            
            .controls {
                gap: 15px;
            }
            
            .btn {
                padding: 12px 20px;
                font-size: 18px;
                min-width: 130px;
            }
        }
        
        @media (max-width: 500px) {
            .game-title {
                font-size: 28px;
            }
            
            .card {
                width: 38px;
                height: 58px;
            }
            
            .status-bar {
                flex-direction: column;
                gap: 8px;
                align-items: center;
            }
        }
        
        .win-message {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.85);
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            z-index: 100;
            box-shadow: 0 0 50px rgba(255, 215, 0, 0.7);
            border: 3px solid #ffd700;
            animation: pulse 2s infinite;
            display: none;
        }
        
        .win-message h2 {
            font-size: 48px;
            color: #ffd700;
            margin-bottom: 20px;
        }
        
        .win-message p {
            font-size: 24px;
            margin-bottom: 30px;
        }
        
        @keyframes pulse {
            0% { box-shadow: 0 0 50px rgba(255, 215, 0, 0.7); }
            50% { box-shadow: 0 0 70px rgba(255, 215, 0, 0.9); }
            100% { box-shadow: 0 0 50px rgba(255, 215, 0, 0.7); }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <h1 class="game-title">æ™ºèƒ½AIæ–—åœ°ä¸»</h1>
        
        <div class="status-bar">
            <div class="status">å½“å‰ç©å®¶: <span id="current-player">ç©å®¶1</span></div>
            <div class="status">åœ°ä¸»: <span id="landlord">æœªç¡®å®š</span></div>
            <div class="status">å‰©ä½™ç‰Œ: <span id="remaining-cards">54</span>å¼ </div>
        </div>
        
        <div class="game-area">
            <div class="players">
                <div class="player" id="player2">
                    <div class="player-name">
                        <span>ç©å®¶2 (ç”µè„‘)</span>
                        <span class="landlord-tag" id="landlord-tag2" style="display:none">åœ°ä¸»</span>
                    </div>
                    <div class="ai-level">é«˜çº§AIç­–ç•¥</div>
                    <div class="player-cards" id="player2-cards"></div>
                </div>
                
                <div class="player" id="player1">
                    <div class="player-name">
                        <span>ç©å®¶1 (ä½ )</span>
                        <span class="landlord-tag" id="landlord-tag1" style="display:none">åœ°ä¸»</span>
                    </div>
                    <div class="player-cards" id="player1-cards"></div>
                </div>
                
                <div class="player" id="player3">
                    <div class="player-name">
                        <span>ç©å®¶3 (ç”µè„‘)</span>
                        <span class="landlord-tag" id="landlord-tag3" style="display:none">åœ°ä¸»</span>
                    </div>
                    <div class="ai-level">é«˜çº§AIç­–ç•¥</div>
                    <div class="player-cards" id="player3-cards"></div>
                </div>
            </div>
            
            <div class="landlord-cards">
                <div class="info-title">
                    <i>ğŸ‘‘</i>
                    <span>åœ°ä¸»ç‰Œ</span>
                </div>
                <div class="player-cards" id="landlord-cards"></div>
            </div>
            
            <div class="game-info">
                <div class="info-title">
                    <i>â„¹ï¸</i>
                    <span>æ¸¸æˆä¿¡æ¯</span>
                </div>
                <div class="info-content" id="game-info">æ¸¸æˆå‡†å¤‡ä¸­ï¼Œç‚¹å‡»"å¼€å§‹æ¸¸æˆ"æŒ‰é’®å‘ç‰Œ...</div>
                <div class="info-title">
                    <i>ğŸƒ</i>
                    <span>å½“å‰å‡ºç‰Œ</span>
                </div>
                <div class="current-play" id="current-play">æš‚æ— å‡ºç‰Œ</div>
            </div>
            
            <div class="controls">
                <button id="start-btn" class="btn">å¼€å§‹æ¸¸æˆ</button>
                <button id="play-btn" class="btn" disabled>å‡ºç‰Œ</button>
                <button id="pass-btn" class="btn" disabled>ä¸å‡º</button>
                <button id="hint-btn" class="btn" disabled>æç¤º</button>
                <button id="reset-btn" class="btn">é‡æ–°å¼€å§‹</button>
            </div>
        </div>
        
        <div class="win-message" id="win-message">
            <h2>æ¸¸æˆç»“æŸ!</h2>
            <p id="winner-text">ç©å®¶1 è·èƒœ!</p>
            <button class="btn" id="play-again-btn">å†ç©ä¸€æ¬¡</button>
        </div>
    </div>

    <script>
        // æ¸¸æˆæ ¸å¿ƒé€»è¾‘
        class DouDiZhuGame {
            constructor() {
                this.players = {
                    player1: { name: "ç©å®¶1", cards: [], isLandlord: false },
                    player2: { name: "ç©å®¶2", cards: [], isLandlord: false },
                    player3: { name: "ç©å®¶3", cards: [], isLandlord: false }
                };
                
                this.deck = [];
                this.landlordCards = [];
                this.currentPlayer = "player1";
                this.landlord = "";
                this.lastPlay = { player: null, cards: [], type: null };
                this.gameStarted = false;
                this.gameOver = false;
                this.selectedCards = [];
                this.cardOrder = this.createCardOrder();
            }
            
            // åˆ›å»ºç‰Œåºæ˜ å°„
            createCardOrder() {
                const order = {};
                const values = ["3", "4", "5", "6", "7", "8", "9", "10", "J", "Q", "K", "A", "2"];
                
                values.forEach((value, index) => {
                    order[value] = index + 1;
                });
                
                order["å°ç‹"] = 14;
                order["å¤§ç‹"] = 15;
                
                return order;
            }
            
            // è·å–ç‰Œçš„å¤§å°å€¼
            getCardValue(card) {
                return this.cardOrder[card.value] || 0;
            }
            
            // åˆ›å»ºä¸€å‰¯æ‰‘å…‹ç‰Œ
            createDeck() {
                const suits = ["â™ ", "â™¥", "â™¦", "â™£"];
                const values = ["3", "4", "5", "6", "7", "8", "9", "10", "J", "Q", "K", "A", "2"];
                
                // åˆ›å»ºæ™®é€šç‰Œ
                for (let suit of suits) {
                    for (let value of values) {
                        this.deck.push({
                            suit,
                            value,
                            color: suit === "â™¥" || suit === "â™¦" ? "red" : "black",
                            weight: this.getCardValue({value})
                        });
                    }
                }
                
                // æ·»åŠ å¤§å°ç‹
                this.deck.push({ suit: "å°ç‹", value: "å°ç‹", color: "black", weight: 14 });
                this.deck.push({ suit: "å¤§ç‹", value: "å¤§ç‹", color: "red", weight: 15 });
            }
            
            // æ´—ç‰Œ
            shuffleDeck() {
                for (let i = this.deck.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [this.deck[i], this.deck[j]] = [this.deck[j], this.deck[i]];
                }
            }
            
            // å‘ç‰Œ
            dealCards() {
                // å‘ç‰Œç»™ä¸‰ä½ç©å®¶ï¼ˆæ¯äºº17å¼ ï¼‰
                for (let i = 0; i < 51; i++) {
                    const player = Object.keys(this.players)[i % 3];
                    this.players[player].cards.push(this.deck[i]);
                }
                
                // å‰©ä½™3å¼ ä½œä¸ºåœ°ä¸»ç‰Œ
                this.landlordCards = this.deck.slice(51, 54);
            }
            
            // å¼€å§‹æ¸¸æˆ
            startGame() {
                this.deck = [];
                this.landlordCards = [];
                this.lastPlay = { player: null, cards: [], type: null };
                this.gameStarted = true;
                this.gameOver = false;
                this.selectedCards = [];
                
                // é‡ç½®ç©å®¶çŠ¶æ€
                Object.keys(this.players).forEach(player => {
                    this.players[player].cards = [];
                    this.players[player].isLandlord = false;
                });
                
                // åˆ›å»ºç‰Œå †ã€æ´—ç‰Œå’Œå‘ç‰Œ
                this.createDeck();
                this.shuffleDeck();
                this.dealCards();
                
                // æ’åºç©å®¶æ‰‹ç‰Œ
                this.sortPlayerCards();
                
                // éšæœºé€‰æ‹©åœ°ä¸»
                this.selectLandlord();
            }
            
            // æ’åºç©å®¶æ‰‹ç‰Œ
            sortPlayerCards() {
                Object.keys(this.players).forEach(player => {
                    this.players[player].cards.sort((a, b) => a.weight - b.weight);
                });
            }
            
            // é€‰æ‹©åœ°ä¸»
            selectLandlord() {
                // éšæœºé€‰æ‹©ä¸€ä¸ªç©å®¶ä½œä¸ºåœ°ä¸»
                const players = Object.keys(this.players);
                const landlord = players[Math.floor(Math.random() * players.length)];
                
                this.landlord = landlord;
                this.players[landlord].isLandlord = true;
                
                // åœ°ä¸»è·å¾—ä¸‰å¼ åœ°ä¸»ç‰Œ
                this.players[landlord].cards = this.players[landlord].cards.concat(this.landlordCards);
                this.sortPlayerCards();
                
                // åœ°ä¸»å…ˆå‡ºç‰Œ
                this.currentPlayer = landlord;
            }
            
            // ç©å®¶å‡ºç‰Œ
            playCards(player, cards) {
                // ä»ç©å®¶æ‰‹ç‰Œä¸­ç§»é™¤
                this.players[player].cards = this.players[player].cards.filter(
                    card => !cards.includes(card)
                );
                
                // ç¡®å®šç‰Œå‹
                const cardType = this.determineCardType(cards);
                
                // æ›´æ–°æœ€åå‡ºç‰Œ
                this.lastPlay = { player, cards, type: cardType };
                
                // æ£€æŸ¥æ¸¸æˆæ˜¯å¦ç»“æŸ
                if (this.players[player].cards.length === 0) {
                    this.gameOver = true;
                    return true; // æ¸¸æˆç»“æŸ
                }
                
                // è½®åˆ°ä¸‹ä¸€ä½ç©å®¶
                this.nextPlayer();
                return false;
            }
            
            // åˆ¤æ–­ç‰Œå‹
            determineCardType(cards) {
                const len = cards.length;
                const cardCounts = this.countCardValues(cards);
                const cardValues = cards.map(card => card.weight);
                const maxCount = Math.max(...Object.values(cardCounts));
                const distinctValues = Object.keys(cardCounts).length;
                
                // å•ç‰Œ
                if (len === 1) return { type: "single", value: cardValues[0] };
                
                // å¯¹å­
                if (len === 2 && maxCount === 2) return { type: "pair", value: cardValues[0] };
                
                // ä¸‰å¼ 
                if (len === 3 && maxCount === 3) return { type: "triplet", value: cardValues[0] };
                
                // ç‚¸å¼¹ï¼ˆå››å¼ ç›¸åŒï¼‰
                if (len === 4 && maxCount === 4) return { type: "bomb", value: cardValues[0] };
                
                // ç‹ç‚¸
                if (len === 2 && cardValues.includes(14) && cardValues.includes(15)) {
                    return { type: "rocket", value: 15 };
                }
                
                // é¡ºå­ (5å¼ æˆ–ä»¥ä¸Šè¿ç»­å•ç‰Œ)
                if (len >= 5 && this.isStraight(cardValues)) {
                    return { type: "straight", value: Math.max(...cardValues), length: len };
                }
                
                // è¿å¯¹
                if (len >= 6 && len % 2 === 0 && this.isConsecutivePairs(cardCounts)) {
                    return { type: "consecutive_pairs", value: Math.max(...cardValues), length: len/2 };
                }
                
                // ä¸‰å¸¦ä¸€
                if (len === 4 && maxCount === 3 && distinctValues === 2) {
                    return { type: "triplet_plus_single", value: this.getTripletValue(cardCounts) };
                }
                
                // ä¸‰å¸¦äºŒ
                if (len === 5 && maxCount === 3 && distinctValues === 2) {
                    return { type: "triplet_plus_pair", value: this.getTripletValue(cardCounts) };
                }
                
                return null;
            }
            
            // è¾…åŠ©æ–¹æ³•ï¼šç»Ÿè®¡ç‰Œå€¼å‡ºç°æ¬¡æ•°
            countCardValues(cards) {
                const count = {};
                cards.forEach(card => {
                    count[card.weight] = (count[card.weight] || 0) + 1;
                });
                return count;
            }
            
            // è¾…åŠ©æ–¹æ³•ï¼šåˆ¤æ–­æ˜¯å¦ä¸ºé¡ºå­
            isStraight(values) {
                const sorted = [...new Set(values)].sort((a, b) => a - b);
                if (sorted.length < 5) return false;
                
                // æ£€æŸ¥æ˜¯å¦è¿ç»­
                for (let i = 1; i < sorted.length; i++) {
                    if (sorted[i] - sorted[i-1] !== 1) return false;
                }
                return true;
            }
            
            // è¾…åŠ©æ–¹æ³•ï¼šåˆ¤æ–­æ˜¯å¦ä¸ºè¿å¯¹
            isConsecutivePairs(cardCounts) {
                const pairs = Object.entries(cardCounts)
                    .filter(([_, count]) => count === 2)
                    .map(([value]) => parseInt(value))
                    .sort((a, b) => a - b);
                
                if (pairs.length < 3) return false;
                
                // æ£€æŸ¥æ˜¯å¦è¿ç»­
                for (let i = 1; i < pairs.length; i++) {
                    if (pairs[i] - pairs[i-1] !== 1) return false;
                }
                return true;
            }
            
            // è¾…åŠ©æ–¹æ³•ï¼šè·å–ä¸‰å¼ çš„å€¼
            getTripletValue(cardCounts) {
                for (const [value, count] of Object.entries(cardCounts)) {
                    if (count === 3) return parseInt(value);
                }
                return null;
            }
            
            // è½®åˆ°ä¸‹ä¸€ä½ç©å®¶
            nextPlayer() {
                const players = Object.keys(this.players);
                const currentIndex = players.indexOf(this.currentPlayer);
                this.currentPlayer = players[(currentIndex + 1) % players.length];
            }
            
            // æ£€æŸ¥å‡ºç‰Œæ˜¯å¦æœ‰æ•ˆ
            isValidPlay(cards) {
                if (cards.length === 0) return false;
                
                // åˆ¤æ–­ç‰Œå‹
                const cardType = this.determineCardType(cards);
                if (!cardType) return false;
                
                // å¦‚æœå½“å‰æ²¡æœ‰å‡ºç‰Œï¼Œä»»ä½•æœ‰æ•ˆç‰Œå‹éƒ½å¯ä»¥å‡º
                if (!this.lastPlay.type) return true;
                
                // å¦‚æœä¸Šå®¶å‡ºçš„æ˜¯ç‹ç‚¸ï¼Œåªèƒ½è·Ÿç‹ç‚¸
                if (this.lastPlay.type.type === "rocket") {
                    return cardType.type === "rocket";
                }
                
                // ç‚¸å¼¹å¯ä»¥å‹ä»»ä½•éç‹ç‚¸çš„ç‰Œ
                if (cardType.type === "bomb" || cardType.type === "rocket") {
                    return true;
                }
                
                // åŒç±»å‹ç‰Œæ¯”è¾ƒå¤§å°
                if (cardType.type === this.lastPlay.type.type) {
                    // ç‰¹æ®Šå¤„ç†é¡ºå­å’Œè¿å¯¹
                    if (cardType.type === "straight" || cardType.type === "consecutive_pairs") {
                        if (cardType.length !== this.lastPlay.type.length) return false;
                        return cardType.value > this.lastPlay.type.value;
                    }
                    
                    // å…¶ä»–ç±»å‹æ¯”è¾ƒå€¼
                    return cardType.value > this.lastPlay.type.value;
                }
                
                return false;
            }
            
            // æ™ºèƒ½ç”µè„‘å‡ºç‰Œ
            smartComputerPlay(player) {
                const cards = [...this.players[player].cards];
                const hand = [...cards];
                
                // å¦‚æœæ²¡æœ‰ä¸Šå®¶å‡ºç‰Œï¼Œå‡ºæœ€å°çš„æœ‰æ•ˆç‰Œ
                if (!this.lastPlay.type) {
                    return this.playSmallestValidCards(player, cards);
                }
                
                // å°è¯•å‡ºèƒ½å‹è¿‡ä¸Šå®¶çš„æœ€å°ç‰Œ
                const play = this.findMinimalBeatingPlay(player, cards);
                if (play.length > 0) {
                    this.playCards(player, play);
                    return play;
                }
                
                // å¦‚æœæœ‰ç‚¸å¼¹ä¸”å€¼å¾—ä½¿ç”¨ï¼Œå‡ºç‚¸å¼¹
                const bomb = this.findBomb(cards);
                if (bomb && this.shouldPlayBomb(player, bomb)) {
                    this.playCards(player, bomb);
                    return bomb;
                }
                
                // æ²¡æœ‰åˆé€‚çš„ç‰Œï¼Œé€‰æ‹©ä¸å‡º
                this.nextPlayer();
                return [];
            }
            
            // æ‰¾å‡ºèƒ½å‹è¿‡ä¸Šå®¶çš„æœ€å°ç‰Œ
            findMinimalBeatingPlay(player, cards) {
                const possiblePlays = this.findAllPossiblePlays(cards);
                
                // è¿‡æ»¤å‡ºèƒ½å‹è¿‡ä¸Šå®¶çš„ç‰Œ
                const beatingPlays = possiblePlays.filter(play => {
                    const type = this.determineCardType(play);
                    return type && this.isPlayBeating(type);
                });
                
                if (beatingPlays.length === 0) return [];
                
                // æ‰¾å‡ºæœ€å°ç‰ŒåŠ›çš„å‡ºç‰Œ
                beatingPlays.sort((a, b) => {
                    return this.calculatePlayStrength(a) - this.calculatePlayStrength(b);
                });
                
                return beatingPlays[0];
            }
            
            // è®¡ç®—ç‰ŒåŠ›
            calculatePlayStrength(cards) {
                return cards.reduce((sum, card) => sum + card.weight, 0);
            }
            
            // åˆ¤æ–­å‡ºç‰Œæ˜¯å¦èƒ½å‹è¿‡ä¸Šå®¶
            isPlayBeating(playType) {
                // ç‚¸å¼¹å¯ä»¥å‹ä»»ä½•éç‹ç‚¸çš„ç‰Œ
                if (playType.type === "bomb" || playType.type === "rocket") {
                    return true;
                }
                
                // åŒç±»å‹ç‰Œæ¯”è¾ƒå¤§å°
                if (playType.type === this.lastPlay.type.type) {
                    if (playType.type === "straight" || playType.type === "consecutive_pairs") {
                        if (playType.length !== this.lastPlay.type.length) return false;
                        return playType.value > this.lastPlay.type.value;
                    }
                    return playType.value > this.lastPlay.type.value;
                }
                
                return false;
            }
            
            // æ‰¾å‡ºæ‰€æœ‰å¯èƒ½çš„å‡ºç‰Œ
            findAllPossiblePlays(cards) {
                const plays = [];
                
                // å•ç‰Œ
                cards.forEach(card => plays.push([card]));
                
                // å¯¹å­
                const pairCandidates = this.findGroups(cards, 2);
                pairCandidates.forEach(group => plays.push(group));
                
                // ä¸‰å¼ 
                const tripletCandidates = this.findGroups(cards, 3);
                tripletCandidates.forEach(group => plays.push(group));
                
                // ç‚¸å¼¹
                const bombCandidates = this.findGroups(cards, 4);
                bombCandidates.forEach(group => plays.push(group));
                
                // ç‹ç‚¸
                const rocket = cards.filter(card => card.weight === 14 || card.weight === 15);
                if (rocket.length === 2 && rocket[0].weight !== rocket[1].weight) {
                    plays.push(rocket);
                }
                
                return plays;
            }
            
            // æ‰¾å‡ºç›¸åŒç‰Œå€¼çš„ç»„
            findGroups(cards, groupSize) {
                const groups = [];
                const countMap = {};
                
                cards.forEach(card => {
                    countMap[card.weight] = (countMap[card.weight] || 0) + 1;
                });
                
                Object.keys(countMap).forEach(value => {
                    if (countMap[value] >= groupSize) {
                        const group = cards.filter(card => card.weight === parseInt(value)).slice(0, groupSize);
                        groups.push(group);
                    }
                });
                
                return groups;
            }
            
            // æ‰¾å‡ºç‚¸å¼¹
            findBomb(cards) {
                // æ‰¾æ™®é€šç‚¸å¼¹
                const bomb = this.findGroups(cards, 4);
                if (bomb.length > 0) return bomb[0];
                
                // æ‰¾ç‹ç‚¸
                const rocket = cards.filter(card => card.weight === 14 || card.weight === 15);
                if (rocket.length === 2) return rocket;
                
                return null;
            }
            
            // åˆ¤æ–­æ˜¯å¦åº”è¯¥å‡ºç‚¸å¼¹
            shouldPlayBomb(player, bomb) {
                // å¦‚æœæ˜¯åœ°ä¸»ä¸”ç‰Œå¾ˆå¥½ï¼Œå¯ä»¥å‡º
                if (this.players[player].isLandlord && this.players[player].cards.length > 5) {
                    return true;
                }
                
                // å¦‚æœç‰Œå¾ˆå°‘ä¸”èƒ½èµ¢ï¼Œå‡ºç‚¸å¼¹
                if (this.players[player].cards.length <= 5) {
                    return true;
                }
                
                // å…¶ä»–æƒ…å†µè°¨æ…å‡ºç‚¸å¼¹
                return Math.random() > 0.7;
            }
            
            // å‡ºæœ€å°çš„æœ‰æ•ˆç‰Œ
            playSmallestValidCards(player, cards) {
                // å°è¯•å‡ºæœ€å°çš„å•ç‰Œ
                const single = [cards[0]];
                if (this.isValidPlay(single)) {
                    this.playCards(player, single);
                    return single;
                }
                
                // å°è¯•å‡ºæœ€å°çš„å¯¹å­
                for (let i = 0; i < cards.length - 1; i++) {
                    if (cards[i].weight === cards[i+1].weight) {
                        const pair = [cards[i], cards[i+1]];
                        if (this.isValidPlay(pair)) {
                            this.playCards(player, pair);
                            return pair;
                        }
                    }
                }
                
                // å°è¯•å‡ºæœ€å°çš„ä¸‰å¼ 
                for (let i = 0; i < cards.length - 2; i++) {
                    if (cards[i].weight === cards[i+1].weight && 
                        cards[i].weight === cards[i+2].weight) {
                        const triplet = [cards[i], cards[i+1], cards[i+2]];
                        if (this.isValidPlay(triplet)) {
                            this.playCards(player, triplet);
                            return triplet;
                        }
                    }
                }
                
                // æ²¡æœ‰åˆé€‚çš„ç‰Œï¼Œé€‰æ‹©ä¸å‡º
                this.nextPlayer();
                return [];
            }
            
            // è·å–æç¤º
            getHint() {
                if (this.currentPlayer !== "player1") return [];
                
                const cards = [...this.players.player1.cards];
                const possiblePlays = this.findAllPossiblePlays(cards);
                
                // è¿‡æ»¤å‡ºæœ‰æ•ˆçš„ç‰Œ
                const validPlays = possiblePlays.filter(play => this.isValidPlay(play));
                
                if (validPlays.length === 0) return [];
                
                // æ‰¾å‡ºæœ€å°ç‰ŒåŠ›çš„å‡ºç‰Œ
                validPlays.sort((a, b) => {
                    return this.calculatePlayStrength(a) - this.calculatePlayStrength(b);
                });
                
                return validPlays[0];
            }
        }

        // æ¸¸æˆUIæ§åˆ¶
        class GameUI {
            constructor(game) {
                this.game = game;
                this.domElements = {
                    startBtn: document.getElementById('start-btn'),
                    playBtn: document.getElementById('play-btn'),
                    passBtn: document.getElementById('pass-btn'),
                    hintBtn: document.getElementById('hint-btn'),
                    resetBtn: document.getElementById('reset-btn'),
                    gameInfo: document.getElementById('game-info'),
                    currentPlay: document.getElementById('current-play'),
                    landlordCards: document.getElementById('landlord-cards'),
                    player1Cards: document.getElementById('player1-cards'),
                    player2Cards: document.getElementById('player2-cards'),
                    player3Cards: document.getElementById('player3-cards'),
                    currentPlayer: document.getElementById('current-player'),
                    landlord: document.getElementById('landlord'),
                    remainingCards: document.getElementById('remaining-cards'),
                    player1: document.getElementById('player1'),
                    player2: document.getElementById('player2'),
                    player3: document.getElementById('player3'),
                    landlordTag1: document.getElementById('landlord-tag1'),
                    landlordTag2: document.getElementById('landlord-tag2'),
                    landlordTag3: document.getElementById('landlord-tag3'),
                    winMessage: document.getElementById('win-message'),
                    winnerText: document.getElementById('winner-text'),
                    playAgainBtn: document.getElementById('play-again-btn')
                };
                
                this.setupEventListeners();
            }
            
            setupEventListeners() {
                this.domElements.startBtn.addEventListener('click', () => this.startGame());
                this.domElements.playBtn.addEventListener('click', () => this.playSelectedCards());
                this.domElements.passBtn.addEventListener('click', () => this.passTurn());
                this.domElements.hintBtn.addEventListener('click', () => this.showHint());
                this.domElements.resetBtn.addEventListener('click', () => this.resetGame());
                this.domElements.playAgainBtn.addEventListener('click', () => this.resetGame());
            }
            
            startGame() {
                this.game.startGame();
                this.updateUI();
                this.domElements.gameInfo.textContent = "æ¸¸æˆå¼€å§‹ï¼è¯·å‡ºç‰Œã€‚";
                this.domElements.playBtn.disabled = false;
                this.domElements.passBtn.disabled = false;
                this.domElements.hintBtn.disabled = false;
                this.domElements.winMessage.style.display = 'none';
            }
            
            resetGame() {
                this.game = new DouDiZhuGame();
                this.updateUI();
                this.domElements.gameInfo.textContent = "æ¸¸æˆå·²é‡ç½®ï¼Œç‚¹å‡»'å¼€å§‹æ¸¸æˆ'æŒ‰é’®å‘ç‰Œ";
                this.domElements.playBtn.disabled = true;
                this.domElements.passBtn.disabled = true;
                this.domElements.hintBtn.disabled = true;
                this.domElements.winMessage.style.display = 'none';
            }
            
            updateUI() {
                // æ›´æ–°ç©å®¶å¡ç‰‡
                this.renderPlayerCards('player1', this.game.players.player1.cards);
                this.renderPlayerCards('player2', this.game.players.player2.cards, true);
                this.renderPlayerCards('player3', this.game.players.player3.cards, true);
                
                // æ›´æ–°åœ°ä¸»ç‰Œ
                this.renderLandlordCards();
                
                // æ›´æ–°å½“å‰ç©å®¶
                this.domElements.currentPlayer.textContent = 
                    this.game.players[this.game.currentPlayer].name;
                
                // æ›´æ–°åœ°ä¸»ä¿¡æ¯
                this.domElements.landlord.textContent = 
                    this.game.landlord ? this.game.players[this.game.landlord].name : "æœªç¡®å®š";
                
                // æ›´æ–°åœ°ä¸»æ ‡ç­¾
                this.domElements.landlordTag1.style.display = this.game.players.player1.isLandlord ? 'block' : 'none';
                this.domElements.landlordTag2.style.display = this.game.players.player2.isLandlord ? 'block' : 'none';
                this.domElements.landlordTag3.style.display = this.game.players.player3.isLandlord ? 'block' : 'none';
                
                // æ›´æ–°å‰©ä½™ç‰Œæ•°
                this.domElements.remainingCards.textContent = 
                    this.game.players.player1.cards.length + 
                    this.game.players.player2.cards.length + 
                    this.game.players.player3.cards.length;
                
                // é«˜äº®å½“å‰ç©å®¶
                this.domElements.player1.classList.toggle('active', this.game.currentPlayer === 'player1');
                this.domElements.player2.classList.toggle('active', this.game.currentPlayer === 'player2');
                this.domElements.player3.classList.toggle('active', this.game.currentPlayer === 'player3');
                
                // æ›´æ–°æœ€åå‡ºç‰Œ
                this.renderCurrentPlay();
                
                // å¦‚æœæ¸¸æˆç»“æŸï¼Œæ˜¾ç¤ºèƒœåˆ©ä¿¡æ¯
                if (this.game.gameOver) {
                    this.showWinMessage(this.game.lastPlay.player);
                }
            }
            
            renderPlayerCards(playerId, cards, hide = false) {
                const container = this.domElements[`${playerId}Cards`];
                container.innerHTML = '';
                
                cards.forEach((card, index) => {
                    const cardElement = document.createElement('div');
                    cardElement.className = `card ${card.color}`;
                    
                    if (hide) {
                        cardElement.innerHTML = `
                            <div class="card-back"></div>
                        `;
                    } else {
                        cardElement.innerHTML = `
                            <div class="card-top">${card.suit}</div>
                            <div class="card-value">${card.value}</div>
                            <div class="card-bottom">${card.suit}</div>
                        `;
                        
                        // ä¸ºç©å®¶1çš„å¡ç‰Œæ·»åŠ ç‚¹å‡»äº‹ä»¶
                        if (playerId === 'player1') {
                            cardElement.addEventListener('click', () => this.toggleCardSelection(card, cardElement));
                        }
                    }
                    
                    container.appendChild(cardElement);
                });
            }
            
            renderLandlordCards() {
                const container = this.domElements.landlordCards;
                container.innerHTML = '';
                
                this.game.landlordCards.forEach(card => {
                    const cardElement = document.createElement('div');
                    cardElement.className = `card ${card.color}`;
                    cardElement.innerHTML = `
                        <div class="card-top">${card.suit}</div>
                        <div class="card-value">${card.value}</div>
                        <div class="card-bottom">${card.suit}</div>
                    `;
                    container.appendChild(cardElement);
                });
            }
            
            renderCurrentPlay() {
                const container = this.domElements.currentPlay;
                container.innerHTML = '';
                
                if (this.game.lastPlay.cards.length > 0) {
                    this.game.lastPlay.cards.forEach(card => {
                        const cardElement = document.createElement('div');
                        cardElement.className = `card ${card.color}`;
                        cardElement.innerHTML = `
                            <div class="card-top">${card.suit}</div>
                            <div class="card-value">${card.value}</div>
                            <div class="card-bottom">${card.suit}</div>
                        `;
                        container.appendChild(cardElement);
                    });
                } else {
                    container.textContent = "æš‚æ— å‡ºç‰Œ";
                }
            }
            
            toggleCardSelection(card, cardElement) {
                if (this.game.currentPlayer !== 'player1' || this.game.gameOver) return;
                
                const index = this.game.selectedCards.indexOf(card);
                if (index === -1) {
                    // é€‰ä¸­å¡ç‰Œ
                    this.game.selectedCards.push(card);
                    cardElement.classList.add('selected');
                } else {
                    // å–æ¶ˆé€‰ä¸­
                    this.game.selectedCards.splice(index, 1);
                    cardElement.classList.remove('selected');
                }
            }
            
            playSelectedCards() {
                if (this.game.currentPlayer !== 'player1' || this.game.selectedCards.length === 0) return;
                
                if (this.game.isValidPlay(this.game.selectedCards)) {
                    const gameEnded = this.game.playCards('player1', this.game.selectedCards);
                    this.game.selectedCards = [];
                    
                    if (gameEnded) {
                        this.domElements.gameInfo.textContent = "æ­å–œä½ èµ¢äº†ï¼";
                        this.domElements.playBtn.disabled = true;
                        this.domElements.passBtn.disabled = true;
                        this.domElements.hintBtn.disabled = true;
                    } else {
                        this.domElements.gameInfo.textContent = "ä½ å·²å‡ºç‰Œï¼Œç­‰å¾…å…¶ä»–ç©å®¶...";
                        
                        // æ›´æ–°UIåè®©ç”µè„‘å‡ºç‰Œ
                        this.updateUI();
                        setTimeout(() => this.computerTurn(), 1500);
                    }
                } else {
                    this.domElements.gameInfo.textContent = "å‡ºç‰Œæ— æ•ˆï¼Œè¯·é€‰æ‹©æœ‰æ•ˆçš„ç‰Œå‹ï¼";
                }
                
                this.updateUI();
            }
            
            passTurn() {
                if (this.game.currentPlayer !== 'player1') return;
                
                this.game.nextPlayer();
                this.domElements.gameInfo.textContent = "ä½ é€‰æ‹©ä¸å‡ºï¼Œç­‰å¾…å…¶ä»–ç©å®¶...";
                this.game.selectedCards = [];
                
                this.updateUI();
                setTimeout(() => this.computerTurn(), 1500);
            }
            
            computerTurn() {
                if (this.game.gameOver) return;
                
                // ç”µè„‘ç©å®¶å‡ºç‰Œ
                const player = this.game.currentPlayer;
                const playedCards = this.game.smartComputerPlay(player);
                
                if (this.game.gameOver) {
                    this.domElements.gameInfo.textContent = `${this.game.players[player].name}èµ¢äº†ï¼`;
                    this.domElements.playBtn.disabled = true;
                    this.domElements.passBtn.disabled = true;
                    this.domElements.hintBtn.disabled = true;
                } else {
                    if (playedCards.length > 0) {
                        this.domElements.gameInfo.textContent = 
                            `${this.game.players[player].name}å‡ºç‰Œäº†`;
                    } else {
                        this.domElements.gameInfo.textContent = 
                            `${this.game.players[player].name}é€‰æ‹©ä¸å‡º`;
                    }
                    
                    // å¦‚æœä¸‹ä¸€ä¸ªç©å®¶è¿˜æ˜¯ç”µè„‘ï¼Œç»§ç»­å‡ºç‰Œ
                    if (this.game.currentPlayer !== 'player1') {
                        setTimeout(() => this.computerTurn(), 1500);
                    } else {
                        this.domElements.gameInfo.textContent = "è½®åˆ°ä½ äº†ï¼Œè¯·å‡ºç‰Œ";
                    }
                }
                
                this.updateUI();
            }
            
            showHint() {
                if (this.game.currentPlayer !== 'player1') return;
                
                const hintCards = this.game.getHint();
                if (hintCards.length > 0) {
                    // æ¸…é™¤ä¹‹å‰çš„é€‰æ‹©
                    this.game.selectedCards = [];
                    document.querySelectorAll('.card.selected').forEach(card => {
                        card.classList.remove('selected');
                    });
                    
                    // é€‰æ‹©æç¤ºçš„ç‰Œ
                    hintCards.forEach(card => {
                        this.game.selectedCards.push(card);
                        const cardElements = document.querySelectorAll('#player1-cards .card');
                        cardElements.forEach(cardEl => {
                            const cardValue = cardEl.querySelector('.card-value').textContent;
                            const cardSuit = cardEl.querySelector('.card-top').textContent;
                            if (card.value === cardValue && card.suit === cardSuit) {
                                cardEl.classList.add('selected');
                            }
                        });
                    });
                    
                    this.domElements.gameInfo.textContent = "æç¤ºï¼šå°è¯•å‡ºè¿™äº›ç‰Œï¼";
                } else {
                    this.domElements.gameInfo.textContent = "æç¤ºï¼šæ²¡æœ‰æœ‰æ•ˆçš„å‡ºç‰Œï¼Œå»ºè®®é€‰æ‹©'ä¸å‡º'";
                }
            }
            
            showWinMessage(winnerId) {
                const winner = this.game.players[winnerId].name;
                const isPlayer = winnerId === 'player1';
                
                this.domElements.winnerText.textContent = isPlayer ? 
                    `æ­å–œä½ è·èƒœï¼ä½ æ˜¯${this.game.players[winnerId].isLandlord ? 'åœ°ä¸»' : 'å†œæ°‘'}èƒœåˆ©ï¼` : 
                    `${winner} è·èƒœäº†ï¼`;
                
                this.domElements.winMessage.style.display = 'block';
            }
        }

        // åˆå§‹åŒ–æ¸¸æˆ
        document.addEventListener('DOMContentLoaded', () => {
            const game = new DouDiZhuGame();
            const gameUI = new GameUI(game);
        });
    </script>
</body>
</html>